{% set params = app.request.attributes.get('_route_params')|merge(app.request.query.all()) %}
{% block header %}
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="description" content="Neon Admin Panel" />
	<meta name="author" content="" />
	<link rel="icon" href="images/favicon.ico">
	{{ include('header.html.twig') }}

{% endblock %}
<title>{% block title %}{{ interfaceName }}{% endblock %}</title>
<body class="page-body" data-url="{{ url('indexAdmin') }}">
<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
	{{ include('sidebar_menu.html.twig') }}
	<div class="main-content">
		{{ include('head.html.twig') }}
		<hr />
		{{ include('breadcrumb.html.twig') }}
		<h2>{{ interfaceName }}</h2>
		</br>
		<!-- MAIN CONTENT -->



    <div class="calendar-env">
    			<!-- Calendar Body -->
    			<div class="calendar-body">
    				<div id="calendar"></div>
    			</div>
    			<!-- Sidebar -->
    			<div class="calendar-sidebar">
    				<!-- new task form -->
    				<div class="calendar-sidebar-row">
    					<form role="form" id="add_event_form">
    						<div class="input-group minimal">
    							<input type="text" class="form-control" placeholder="Nuevo evento" />
    							<div class="input-group-addon">
    								<i class="entypo-pencil"></i>
    							</div>
    						</div>
    					</form>
    				</div>

    				<!-- Calendar List -->
    				<ul class="calendar-list events-list" id="calendar-list">
    					<li>
    						<p>Mis Calendarios</p>
    					</li>

    				</ul>
    			</div>
    	</div>


		<!-- END MAIN CONTENT -->
		{{ include('footer.html.twig') }}
	</div>
	{{ include('chat.html.twig') }}
	<!-- Chat Histories -->
	{{ include('chat_histories.html.twig') }}
</div>
	<!-- MODALS  -->

	<!-- END MODALS -->
{% block footer %}

	<link rel="stylesheet" href="{{ url('index') }}js/datatables/datatables.css">
	<link rel="stylesheet" href="{{ url('index') }}js/select2/select2-bootstrap.css">
	<link rel="stylesheet" href="{{ url('index') }}js/select2/select2.css">
  <link rel="stylesheet" href="{{ url('index') }}js/fullcalendar-2/fullcalendar.min.css">
	<!-- Imported scripts on this page -->
 	<script src="{{ url('index') }}js/datatables/datatables.js"></script>
	<script src="{{ url('index') }}js/select2/select2.min.js"></script>
	<script src="{{ url('index') }}js/moment.min.js"></script>
	<script src="{{ url('index') }}js/moment-es.js"></script>
  <script src="{{ url('index') }}js/fullcalendar-2/fullcalendar.min.js"></script>
	<script src='{{ url('index') }}js/fullcalendar-2/lang/es.js'></script>

  <script>
  var fullCalendar = fullCalendar || {};

  ;(function($, window, undefined)
  {
    "use strict";

    $(document).ready(function(){
			var load_wait=0;
      fullCalendar.$container = $(".calendar-env");
      $.extend(fullCalendar, {
        isPresent: fullCalendar.$container.length > 0
      });

      // Mail Container Height fit with the document
      if(fullCalendar.isPresent){
        fullCalendar.$sidebar = fullCalendar.$container.find('.calendar-sidebar');
        fullCalendar.$body = fullCalendar.$container.find('.calendar-body');

        // Checkboxes
        var $cb = fullCalendar.$body.find('table thead input[type="checkbox"], table tfoot input[type="checkbox"]');
        $cb.on('click', function(){
          $cb.attr('checked', this.checked).trigger('change');
          calendar_toggle_checkbox_status(this.checked);
        });
        // Highlight
        fullCalendar.$body.find('table tbody input[type="checkbox"]').on('change', function(){
          $(this).closest('tr')[this.checked ? 'addClass' : 'removeClass']('highlight');
        });

        // Setup Calendar
        if($.isFunction($.fn.fullCalendar)){
          var calendar = $('#calendar');
          calendar.fullCalendar({
            header: {
              left: 'title',
              right: 'month,agendaWeek,agendaDay today prev,next'
            },
            //defaultView: 'basicWeek',
            editable: true,
            firstDay: 1,
            height: 600,
            droppable: true,
            drop: function(date, allDay) {
              var $this = $(this),
                eventObject = {
                  title: $this.text(),
                  start: date,
                  allDay: allDay,
                  className: $this.data('event-class')
                };
              calendar.fullCalendar('renderEvent', eventObject, true);
              $this.remove();
            }
          });

          $("#draggable_events li a").draggable({
            zIndex: 999,
            revert: true,
            revertDuration: 0
          }).on('click', function(){
            return false;
          });
        }
        else{
          alert("Please include full-calendar script!");
        }

        $("body").on('submit', '#add_event_form', function(ev){
          ev.preventDefault();
          var text = $("#add_event_form input");
          if(text.val().length == 0)
            return false;

          var classes = ['', 'color-green', 'color-blue', 'color-orange', 'color-primary', ''],
            _class = classes[ Math.floor(classes.length * Math.random()) ],
            $event = $('<li><a href="#"></a></li>');
          $event.find('a').text(text.val()).addClass(_class).attr('data-event-class', _class);
          $event.appendTo($("#draggable_events"));
          $("#draggable_events li a").draggable({
            zIndex: 999,
            revert: true,
            revertDuration: 0
          }).on('click', function(){
            return false;
          });

          fit_calendar_container_height();
          $event.hide().slideDown('fast');
          text.val('');
          return false;
        });
      }

			//Calendars load
			function getCalendars(url, params){
				if((++load_wait)==1) $("#load-spinner").fadeIn();
					$("#list-messages").html('');
					$.getJSON(url+params, function( data ) {
						$("#calendar-list").html('<li><p>Mis Calendarios</p></li>');
						$.each( data, function( key, val ) {
							$("#calendar-list").append('<li><a style="background: '+val.color+' !important;" href="">'+
																				 '<div class="checkbox checkbox-replace color-white">'+
																				 '<input type="checkbox" class="'+val.id+'-chk-list" id="chk-'+val.id+'">'+
																				 '<label>'+val.name+'</label></div></a></li>');
						});

						replaceCheckboxes();
					}).always(function() {
						if((--load_wait)==0) $("#load-spinner").fadeOut();
					});
			}

			//Events load
			function getEvents(url, params){


			}

			//Initial Load
			getCalendars('{{url('calendarsList')}}', '');
		});
  })(jQuery);

  function fit_calendar_container_height(){
    if(fullCalendar.isPresent){
      if(fullCalendar.$sidebar.height() < fullCalendar.$body.height()){
        fullCalendar.$sidebar.height( fullCalendar.$body.height() );
      }else{
        var old_height = fullCalendar.$sidebar.height();
        fullCalendar.$sidebar.height('');
        if(fullCalendar.$sidebar.height() < fullCalendar.$body.height()){
          fullCalendar.$sidebar.height(old_height);
        }
      }
    }
  }

  function reset_calendar_container_height(){
    if(fullCalendar.isPresent){
      fullCalendar.$sidebar.height('auto');
    }
  }

  function calendar_toggle_checkbox_status(checked){
    fullCalendar.$body.find('table tbody input[type="checkbox"]' + (checked ? '' : ':checked')).attr('checked',  ! checked).click();
  }

  </script>
  {{ include('bottom.html.twig') }}
{% endblock %}
</body>
